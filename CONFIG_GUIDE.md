# MCPå›¾åƒè¯†åˆ«ç³»ç»Ÿé…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†MCPå›¾åƒè¯†åˆ«ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ç»“æ„å’Œå„é…ç½®é¡¹çš„å«ä¹‰ã€‚

## ğŸ”’ å®‰å…¨è¯´æ˜

**âš ï¸ é‡è¦æé†’ï¼š**
- é…ç½®æ–‡ä»¶åŒ…å«APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯
- å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- è¯·å¦¥å–„ä¿ç®¡é…ç½®æ–‡ä»¶ï¼Œä¸è¦åˆ†äº«ç»™ä»–äºº
- å®šæœŸæ›´æ¢APIå¯†é’¥ä»¥ç¡®ä¿å®‰å…¨

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

- **ä¸»é…ç½®æ–‡ä»¶**: `config.json`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
- **é…ç½®æ¨¡æ¿**: `config.template.json`ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰
- **é…ç½®è¯´æ˜**: `CONFIG_GUIDE.md`ï¼ˆæœ¬æ–‡æ¡£ï¼‰

## ğŸ”§ é…ç½®æ–‡ä»¶ç»“æ„

### 1. ç®€é“äº‘é…ç½® (`jiandaoyun`)

```json
{
  "jiandaoyun": {
    "api_key": "YOUR_API_KEY",
    "app_id": "YOUR_APP_ID",
    "entry_id": "YOUR_ENTRY_ID",
    "timeout": 30,
    "max_retries": 3,
    "datetime_field": "_widget_1749173874872",
    "uploader_field": "_widget_1749016991918",
    "description_field": "_widget_1749173874866",
    "attachment_field": "_widget_1749173144404",
    "result_fields": {
      "result_1": "_widget_1749173874867",
      "result_2": "_widget_1749173874868",
      "result_3": "_widget_1749173874869",
      "result_4": "_widget_1749173874870",
      "result_5": "_widget_1749173874871"
    }
  }
}
```

#### é…ç½®é¡¹è¯´æ˜ï¼š

| é…ç½®é¡¹ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `api_key` | string | âœ… | ç®€é“äº‘APIå¯†é’¥ | `YOUR_API_KEY_HERE` |
| `app_id` | string | âœ… | ç®€é“äº‘åº”ç”¨ID | `67d13e0bb840cdf11eccad1e` |
| `entry_id` | string | âœ… | ç®€é“äº‘è¡¨å•ID | `683ff705c700b55c74bb24ab` |
| `timeout` | number | âŒ | APIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | `30` |
| `max_retries` | number | âŒ | APIè¯·æ±‚é‡è¯•æ¬¡æ•° | `3` |
| `datetime_field` | string | âœ… | æ—¥æœŸæ—¶é—´å­—æ®µID | `_widget_1749173874872` |
| `uploader_field` | string | âœ… | ä¸Šä¼ äººå­—æ®µID | `_widget_1749016991918` |
| `description_field` | string | âœ… | æè¿°å­—æ®µID | `_widget_1749173874866` |
| `attachment_field` | string | âœ… | é™„ä»¶å­—æ®µID | `_widget_1749173144404` |
| `result_fields` | object | âœ… | è¯†åˆ«ç»“æœå­—æ®µæ˜ å°„ | è§ä¸‹è¡¨ |

#### è¯†åˆ«ç»“æœå­—æ®µè¯´æ˜ï¼š

| å­—æ®µ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `result_1` | ä¸»è¦è¯†åˆ«ç»“æœ | å­˜å‚¨å®Œæ•´çš„AIè¯†åˆ«å†…å®¹ |
| `result_2` | è®¾å¤‡ä¿¡æ¯ | å­˜å‚¨è®¾å¤‡ç±»å‹ã€å‹å·ç­‰ä¿¡æ¯ |
| `result_3` | æŠ€æœ¯å‚æ•° | å­˜å‚¨å‹åŠ›ã€æ¸©åº¦ã€åŠŸç‡ç­‰å‚æ•° |
| `result_4` | ç¯å¢ƒä¿¡æ¯ | å­˜å‚¨å®‰è£…ä½ç½®ã€ä½¿ç”¨ç¯å¢ƒç­‰ |
| `result_5` | å…ƒæ•°æ® | å­˜å‚¨è¯†åˆ«æ—¶é—´ã€Tokenä½¿ç”¨é‡ç­‰ |

### 2. é€šä¹‰åƒé—®é…ç½® (`qwen_vision`)

```json
{
  "qwen_vision": {
    "api_key": "YOUR_QWEN_API_KEY",
    "api_url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
    "model": "qwen-vl-max-latest",
    "max_tokens": 1500,
    "timeout": 60,
    "max_retries": 3,
    "default_prompt": "è¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹..."
  }
}
```

#### é…ç½®é¡¹è¯´æ˜ï¼š

| é…ç½®é¡¹ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `api_key` | string | âœ… | é€šä¹‰åƒé—®APIå¯†é’¥ | `YOUR_QWEN_API_KEY_HERE` |
| `api_url` | string | âŒ | APIç«¯ç‚¹URL | é»˜è®¤å€¼é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ |
| `model` | string | âŒ | ä½¿ç”¨çš„æ¨¡å‹ | `qwen-vl-max-latest`ï¼ˆæ¨èï¼‰ |
| `max_tokens` | number | âŒ | æœ€å¤§è¾“å‡ºTokenæ•° | `1500`ï¼ˆå½±å“è¯†åˆ«è¯¦ç»†ç¨‹åº¦ï¼‰ |
| `timeout` | number | âŒ | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | `60`ï¼ˆå›¾åƒè¯†åˆ«éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰ |
| `max_retries` | number | âŒ | é‡è¯•æ¬¡æ•° | `3` |
| `default_prompt` | string | âŒ | é»˜è®¤è¯†åˆ«æç¤ºè¯ | å¯è‡ªå®šä¹‰ä»¥è·å¾—æ›´å¥½æ•ˆæœ |

#### å¯ç”¨æ¨¡å‹ï¼š

| æ¨¡å‹åç§° | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|
| `qwen-vl-max-latest` | æœ€é«˜ç²¾åº¦ | æ¨èä½¿ç”¨ï¼Œè¯†åˆ«æ•ˆæœæœ€å¥½ |
| `qwen-vl-plus` | å¹³è¡¡æ€§èƒ½ | æˆæœ¬å’Œæ•ˆæœçš„å¹³è¡¡ |
| `qwen-vl` | åŸºç¡€ç‰ˆæœ¬ | ç®€å•è¯†åˆ«ä»»åŠ¡ |

### 3. å›¾åƒå¤„ç†é…ç½® (`image_processing`)

```json
{
  "image_processing": {
    "max_image_size": 52428800,
    "min_image_size": 1024,
    "download_timeout": 30,
    "supported_formats": ["JPEG", "PNG", "GIF", "BMP", "WEBP"],
    "max_download_retries": 3,
    "enable_image_validation": true,
    "enable_format_conversion": true
  }
}
```

#### é…ç½®é¡¹è¯´æ˜ï¼š

| é…ç½®é¡¹ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | å»ºè®®å€¼ |
|--------|------|------|------|--------|
| `max_image_size` | number | âŒ | æœ€å¤§å›¾ç‰‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰ | `52428800`ï¼ˆ50MBï¼‰ |
| `min_image_size` | number | âŒ | æœ€å°å›¾ç‰‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰ | `1024`ï¼ˆ1KBï¼‰ |
| `download_timeout` | number | âŒ | ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | `30` |
| `supported_formats` | array | âŒ | æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ | `["JPEG", "PNG", "GIF", "BMP", "WEBP"]` |
| `max_download_retries` | number | âŒ | ä¸‹è½½é‡è¯•æ¬¡æ•° | `3` |
| `enable_image_validation` | boolean | âŒ | æ˜¯å¦å¯ç”¨å›¾ç‰‡éªŒè¯ | `true` |
| `enable_format_conversion` | boolean | âŒ | æ˜¯å¦å¯ç”¨æ ¼å¼è½¬æ¢ | `true` |

### 4. ç³»ç»Ÿé…ç½® (`system`)

```json
{
  "system": {
    "log_level": "INFO",
    "log_file": "logs/mcp_server.log",
    "max_concurrent_tasks": 3,
    "enable_cache": false,
    "cache_ttl": 3600
  }
}
```

#### é…ç½®é¡¹è¯´æ˜ï¼š

| é…ç½®é¡¹ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | å¯é€‰å€¼ |
|--------|------|------|------|--------|
| `log_level` | string | âŒ | æ—¥å¿—çº§åˆ« | `DEBUG`, `INFO`, `WARNING`, `ERROR` |
| `log_file` | string | âŒ | æ—¥å¿—æ–‡ä»¶è·¯å¾„ | `logs/mcp_server.log` |
| `max_concurrent_tasks` | number | âŒ | æœ€å¤§å¹¶å‘ä»»åŠ¡æ•° | `1-5`ï¼ˆé¿å…APIé™æµï¼‰ |
| `enable_cache` | boolean | âŒ | æ˜¯å¦å¯ç”¨ç¼“å­˜ | `false`ï¼ˆæš‚æœªå®ç°ï¼‰ |
| `cache_ttl` | number | âŒ | ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ | `3600` |

## ğŸ” å¦‚ä½•è·å–é…ç½®ä¿¡æ¯

### 1. ç®€é“äº‘é…ç½®ä¿¡æ¯

#### APIå¯†é’¥ (`api_key`)
1. ç™»å½•ç®€é“äº‘ç®¡ç†åå°
2. è¿›å…¥"å¼€å‘è€…ä¸­å¿ƒ"
3. åˆ›å»ºæˆ–æŸ¥çœ‹APIå¯†é’¥
4. å¤åˆ¶å¯†é’¥åˆ°é…ç½®æ–‡ä»¶

#### åº”ç”¨ID (`app_id`)
1. åœ¨ç®€é“äº‘ä¸­æ‰“å¼€æ‚¨çš„åº”ç”¨
2. è¿›å…¥"åº”ç”¨è®¾ç½®"
3. æŸ¥çœ‹"åº”ç”¨ä¿¡æ¯"ä¸­çš„åº”ç”¨ID

#### è¡¨å•ID (`entry_id`)
1. åœ¨åº”ç”¨ä¸­æ‰“å¼€ç›®æ ‡è¡¨å•
2. è¿›å…¥"è¡¨å•è®¾ç½®"
3. æŸ¥çœ‹"è¡¨å•ä¿¡æ¯"ä¸­çš„è¡¨å•ID

#### å­—æ®µID
1. åœ¨è¡¨å•è®¾è®¡å™¨ä¸­é€‰æ‹©å­—æ®µ
2. æŸ¥çœ‹å­—æ®µå±æ€§ä¸­çš„"å­—æ®µID"
3. æ ¼å¼é€šå¸¸ä¸º `_widget_xxxxxxxxxx`

### 2. é€šä¹‰åƒé—®é…ç½®ä¿¡æ¯

#### APIå¯†é’¥ (`api_key`)
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥"DashScope"æœåŠ¡
3. åˆ›å»ºæˆ–æŸ¥çœ‹APIå¯†é’¥
4. å¤åˆ¶å¯†é’¥åˆ°é…ç½®æ–‡ä»¶

## ğŸš€ é…ç½®æ–‡ä»¶ä½¿ç”¨

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶
```bash
# å¤åˆ¶æ¨¡æ¿æ–‡ä»¶
cp config.template.json config.json

# ç¼–è¾‘é…ç½®æ–‡ä»¶
# å¡«å…¥æ‚¨çš„å®é™…é…ç½®ä¿¡æ¯
```

### 2. éªŒè¯é…ç½®
ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœé…ç½®æœ‰è¯¯ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚

### 3. é…ç½®ä¼˜å…ˆçº§
1. æŒ‡å®šçš„é…ç½®æ–‡ä»¶
2. é¡¹ç›®æ ¹ç›®å½•çš„ `config.json`
3. ç¯å¢ƒå˜é‡
4. é»˜è®¤å€¼

## ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

1. **ä¸è¦æäº¤é…ç½®æ–‡ä»¶åˆ°ç‰ˆæœ¬æ§åˆ¶**
   - å·²æ·»åŠ åˆ° `.gitignore`
   - å®šæœŸæ£€æŸ¥æ˜¯å¦æ„å¤–æäº¤

2. **å®šæœŸæ›´æ¢APIå¯†é’¥**
   - å»ºè®®æ¯3-6ä¸ªæœˆæ›´æ¢ä¸€æ¬¡
   - å‘ç°æ³„éœ²ç«‹å³æ›´æ¢

3. **é™åˆ¶æ–‡ä»¶è®¿é—®æƒé™**
   - è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™
   - åªå…è®¸å¿…è¦çš„ç”¨æˆ·è®¿é—®

4. **å¤‡ä»½é…ç½®æ–‡ä»¶**
   - å®šæœŸå¤‡ä»½åˆ°å®‰å…¨ä½ç½®
   - é¿å…é…ç½®ä¸¢å¤±

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥**
   - æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

2. **APIå¯†é’¥æ— æ•ˆ**
   - ç¡®è®¤å¯†é’¥æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å¯†é’¥æ˜¯å¦è¿‡æœŸ
   - éªŒè¯APIæƒé™è®¾ç½®

3. **å­—æ®µIDé”™è¯¯**
   - åœ¨ç®€é“äº‘ä¸­é‡æ–°ç¡®è®¤å­—æ®µID
   - ç¡®ä¿å­—æ®µç±»å‹åŒ¹é…

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨DEBUGæ—¥å¿—**
   ```json
   {
     "system": {
       "log_level": "DEBUG"
     }
   }
   ```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   ```bash
   tail -f logs/mcp_server.log
   ```

3. **æµ‹è¯•é…ç½®**
   ```bash
   python test_config.py
   ```

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯
2. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
3. ç¡®è®¤æ‰€æœ‰å¿…å¡«é…ç½®é¡¹éƒ½å·²æ­£ç¡®å¡«å†™
4. éªŒè¯APIå¯†é’¥å’Œæƒé™è®¾ç½®
