# 🖥️ Cursor中使用MCP服务的完整指南

## 🎯 核心概念理解

### Cursor + MCP + AI 的工作原理

```
👤 用户输入自然语言
    ↓
🖥️ Cursor IDE接收请求
    ↓
🤖 AI模型分析请求并选择工具
    ↓
🔧 Cursor调用MCP服务器工具
    ↓
🌐 MCP服务器执行简道云API调用
    ↓
📊 返回结果给AI模型格式化
    ↓
💬 Cursor显示用户友好的回复
```

## 🔧 配置步骤

### 1️⃣ 在Cursor中配置MCP服务器

**找到Cursor配置文件位置:**

- **Windows**: `%APPDATA%\Cursor\User\globalStorage\cursor.mcp\config.json`
- **macOS**: `~/Library/Application Support/Cursor/User/globalStorage/cursor.mcp/config.json`
- **Linux**: `~/.config/Cursor/User/globalStorage/cursor.mcp/config.json`

**配置内容:**
```json
{
  "mcpServers": {
    "jiandaoyun-processor": {
      "command": "python",
      "args": ["core/servers/mcp_server_final.py"],
      "cwd": "/path/to/your/MCP_ImageIdentification",
      "env": {
        "PYTHONPATH": "/path/to/your/MCP_ImageIdentification/core/src",
        "JIANDAOYUN_API_KEY": "your_api_key_here",
        "JIANDAOYUN_APP_ID": "your_app_id_here",
        "JIANDAOYUN_ENTRY_ID": "your_entry_id_here",
        "JIANDAOYUN_SOURCE_FIELD": "_widget_1749016991917",
        "JIANDAOYUN_RESULT_FIELD": "_widget_1749016991918"
      }
    }
  }
}
```

### 2️⃣ 重启Cursor

配置完成后重启Cursor IDE，MCP服务器会自动在后台启动。

## 💬 在聊天窗口中的使用方式

### 📊 查询数据场景

**用户可以这样说:**
- "帮我查询简道云中的数据"
- "显示最近的5条记录"
- "看看简道云里有什么数据"
- "查询一下数据库中的内容"

**AI会自动:**
1. 识别这是查询请求
2. 调用 `query_data` 工具
3. 格式化显示结果

**用户看到的回复示例:**
```
我已经为您查询了简道云中的数据，找到了3条记录：

📄 记录 1:
   ID: 683ff873c9a6587f71b6b880
   原始文本: "测试文本1"
   处理结果: "[已处理] 测试文本1"
   创建时间: 2025-06-04 15:51:16

📄 记录 2:
   ID: 683ff873c9a6587f71b6b881
   原始文本: "重要通知"
   处理结果: "[紧急] 重要通知"
   创建时间: 2025-06-04 15:52:20

📄 记录 3:
   ID: 683ff873c9a6587f71b6b882
   原始文本: "会议安排"
   处理结果: "[已处理] 会议安排"
   创建时间: 2025-06-04 15:53:15
```

### 💾 处理并保存数据场景

**用户可以这样说:**
- "帮我将'重要通知'添加'[紧急]'标识并保存"
- "处理这个文本'会议安排'，加上'[重要]'标记"
- "保存'项目更新'到简道云，标记为'[进行中]'"

**AI会自动:**
1. 提取原始文本和标识
2. 调用 `process_and_save` 工具
3. 确认保存结果

**用户看到的回复示例:**
```
✅ 已成功处理并保存您的文本：

📝 处理详情:
   原始文本: "重要通知"
   处理后: "[紧急] 重要通知"
   保存状态: 成功
   数据ID: 684a1b2c3d4e5f6789abcdef

文本已保存到简道云中，您可以随时查询查看。
```

### 🔄 复杂工作流程场景

**用户可以这样说:**
- "先查询一下现有数据，然后帮我保存一个新的文本"
- "看看数据库里有什么，再添加一条新记录"
- "查询最近的数据，然后处理这个新文本'项目总结'"

**AI会自动:**
1. 分解任务为多个步骤
2. 依次调用相应的工具
3. 综合展示所有结果

## 🎭 实际使用示例

### 示例1: 日常数据管理

**对话流程:**
```
👤 用户: "查看一下简道云里最新的数据"

🤖 AI: 我来为您查询简道云中的最新数据...
      [调用 query_data 工具]
      
      查询完成！找到了5条最新记录：
      1. "项目进度报告" - [已处理] 项目进度报告
      2. "客户反馈" - [重要] 客户反馈
      ...

👤 用户: "帮我添加一条新的记录'月度总结'，标记为'[完成]'"

🤖 AI: 我来为您处理并保存这条新记录...
      [调用 process_and_save 工具]
      
      ✅ 成功保存！
      原始文本: "月度总结"
      处理后: "[完成] 月度总结"
      已保存到简道云中。
```

### 示例2: 批量数据处理

**对话流程:**
```
👤 用户: "我需要处理几个文本，都标记为'[待审核]'"

🤖 AI: 好的，请告诉我需要处理哪些文本。

👤 用户: "处理'合同审查'、'预算申请'、'人员调动'"

🤖 AI: 我来为您逐一处理这些文本...
      
      [依次调用 process_and_save 工具]
      
      ✅ 全部处理完成！
      1. "[待审核] 合同审查" - 已保存
      2. "[待审核] 预算申请" - 已保存  
      3. "[待审核] 人员调动" - 已保存
      
      所有文本都已保存到简道云中。
```

## 🔍 技术细节

### MCP协议通信过程

1. **工具发现阶段**
   ```json
   // Cursor启动时获取工具列表
   Request: {"method": "tools/list"}
   Response: {
     "tools": [
       {"name": "query_data", "description": "查询简道云数据"},
       {"name": "process_and_save", "description": "处理并保存文本"}
     ]
   }
   ```

2. **工具调用阶段**
   ```json
   // AI决定调用工具时
   Request: {
     "method": "tools/call",
     "params": {
       "name": "query_data",
       "arguments": {"limit": 5}
     }
   }
   ```

3. **结果返回阶段**
   ```json
   // MCP服务器返回结果
   Response: {
     "content": [{
       "type": "text", 
       "text": "{\"success\": true, \"data\": [...]}"
     }]
   }
   ```

### AI模型的智能选择

AI模型会根据以下因素选择合适的工具：

- **关键词识别**: "查询"、"显示" → query_data
- **动作识别**: "保存"、"添加"、"处理" → process_and_save
- **参数提取**: 自动从用户输入中提取文本和标识
- **上下文理解**: 理解用户的真实意图

## 🚀 最佳实践

### 1️⃣ 清晰的指令

**好的指令:**
- "查询最近5条数据"
- "将'重要文档'标记为'[紧急]'并保存"

**不够清晰的指令:**
- "处理一下数据"
- "保存这个"

### 2️⃣ 合理的期望

- AI会自动选择合适的工具
- 复杂任务会被分解为多个步骤
- 错误会有友好的提示和建议

### 3️⃣ 有效的沟通

- 使用自然语言，无需记忆命令
- 可以随时询问当前状态
- 可以要求解释执行过程

## 🎉 总结

通过Cursor + MCP + AI的组合，您可以：

- **自然交互**: 用日常语言操作简道云
- **智能处理**: AI自动选择合适的工具
- **无缝集成**: 在IDE中直接管理数据
- **高效工作**: 减少手动操作，提高效率

这种方式让数据处理变得像聊天一样简单！🚀
